generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

// output   = "../generated/prisma"

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id       String  @id @default(uuid())
  email    String  @unique
  name     String
  password String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============= ASSET MODELS =============

enum AssetType {
  WITH_SERIAL_NUMBER                    // مع الرقم التسلسلي
  WITH_CATEGORIES                       // مع أصناف
  WITH_SERIAL_NUMBER_AND_CATEGORIES     // مع الرقم التسلسلي و أصناف
}

model Asset {
  id           String     @id @default(uuid())
  name         String     // الإسم
  serialNumber String?    // الرقم التسلسلي (optional based on type)
  type         AssetType  // Type of asset entry

  // Relations
  categories   AssetCategory[]   @relation("AssetCategories")
  employees    EmployeeAsset[]

  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@index([serialNumber])
}

model AssetCategory {
  id          String   @id @default(uuid())
  name        String   // صنف (category name)

  // Relations
  assetId     String
  asset       Asset    @relation("AssetCategories", fields: [assetId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([assetId])
}

// ============= DEPARTMENT MODEL =============

model Department {
  id        String   @id @default(uuid())
  name      String   @unique  // Department name (must be unique)

  // Relations
  employees Employee[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
}

// ============= EMPLOYEE MODELS =============

enum EmploymentType {
  FULL_TIME                
  PART_TIME               
  INDEPENDENT_CONTRACTOR   
  TEMPORARY_EMPLOYEE    
  INTERN                  
  PER_HOUR             
}

enum EmployeeStatus {
  ACTIVE
  DELETED
}

// ============= DEDUCTION MODELS =============

enum DeductionType {
  MONEY
  DAYS
}

// ============= VACATION MODELS =============

enum VacationReason {
  EMERGENCY_LEAVE
  ANNUAL_LEAVE
}

enum VacationType {
  PAID
  NOT_PAID
}

model Employee {
  id                    String          @id @default(uuid())
  name                  String
  civilId               String?
  civilIdExpiryDate     DateTime?
  passportNo            String?
  passportExpiryDate    DateTime?
  nationality           String?
  jobTitle              String?
  startDate             DateTime?
  type                  EmploymentType
  salary                Decimal?        @db.Decimal(12, 2)
  iban                  String?
  personalEmail         String?
  companyEmail          String?         @unique
  status                EmployeeStatus  @default(ACTIVE)

  // Relations
  departmentId          String?
  department            Department?     @relation(fields: [departmentId], references: [id], onDelete: SetNull)

  assets                EmployeeAsset[]
  attachments           EmployeeAttachment[]
  deductions            Deduction[]
  vacations             Vacation[]

  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt
  deletedAt             DateTime?       // Soft delete timestamp

  @@index([departmentId])
  @@index([type])
  @@index([civilId])
  @@index([companyEmail])
  @@index([deletedAt])
  @@index([status])
}

// Junction table for Employee-Asset many-to-many relationship
model EmployeeAsset {
  id          String    @id @default(uuid())

  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  assetId     String
  asset       Asset     @relation(fields: [assetId], references: [id], onDelete: Cascade)

  assignedAt  DateTime  @default(now())

  @@unique([employeeId, assetId])
  @@index([employeeId])
  @@index([assetId])
}

// Employee attachments 
model EmployeeAttachment {
  id          String    @id @default(uuid())
  url         String    @db.Text  // S3 URL
  fileName    String?   // Original file name for reference
  fileSize    Int?      // File size in bytes
  mimeType    String?   // MIME type (e.g., image/png, application/pdf)

  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  uploadedAt  DateTime  @default(now())

  @@index([employeeId])
}

// Deduction model
model Deduction {
  id         String         @id @default(uuid())
  type       DeductionType
  amount     Decimal?       @db.Decimal(12, 2) // Used when type is MONEY
  days       Int?                           // Used when type is DAYS
  month      DateTime                       // Any date within the month

  // Relations
  employeeId String
  employee   Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt

  @@index([employeeId])
  @@index([month])
}

// Vacation model
model Vacation {
  id            String          @id @default(uuid())
  employeeId    String
  employee      Employee        @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  departureDay  DateTime
  returnDay     DateTime

  reason        VacationReason
  type          VacationType

  numberOfDays  Int

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  @@index([employeeId])
  @@index([departureDay])
  @@index([returnDay])
}
